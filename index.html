<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>ï¼’å¹´ï¼’çµ„å¿…å‹ã€€ç™¾äººä¸€é¦–æš—è¨˜ã‚½ãƒ•ãƒˆ</title>
  <style>
    :root{
      --bg:#0b1220; --card:#111a2e; --txt:#e8eeff; --muted:#a9b4d6;
      --accent:#7aa2ff; --good:#28c76f; --bad:#ff4d4f; --warn:#ffcc66;
      --gold:#ffd166; --silver:#cdd7ff; --bronze:#ffb3c1;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP",system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--txt);
    }
    header{
      padding:14px 14px 8px;
      position:sticky; top:0;
      background:linear-gradient(180deg, rgba(11,18,32,.98), rgba(11,18,32,.85));
      backdrop-filter: blur(8px);
      z-index:10;
    }
    h1{margin:0; font-size:18px; letter-spacing:.02em;}
    .sub{margin-top:6px; font-size:12px; color:var(--muted); display:flex; gap:10px; flex-wrap:wrap;}
    .pill{padding:4px 8px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);}
    main{padding:12px 14px 18px; max-width:980px; margin:0 auto;}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--txt);
      padding:10px 12px;
      border-radius:12px;
      font-size:14px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{transform:scale(.99)}
    .btn.primary{background:rgba(122,162,255,.18); border-color:rgba(122,162,255,.45);}
    .btn.small{padding:8px 10px; font-size:13px; border-radius:10px;}
    .btn.danger{background:rgba(255,77,79,.10); border-color:rgba(255,77,79,.35);}
    .select{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--txt);
      padding:10px 12px;
      border-radius:12px;
      font-size:14px;
    }
    .card{
      background:var(--card);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:14px;
      margin-top:12px;
      box-shadow:0 8px 24px rgba(0,0,0,.25);
    }
    .label{font-size:12px; color:var(--muted); margin-bottom:6px;}
    .kami{font-size:24px; line-height:1.6; letter-spacing:.03em;}
    .choices{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media (min-width:760px){
      .choices{grid-template-columns: 1fr 1fr;}
    }
    .choiceBtn{
      text-align:left;
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--txt);
      font-size:18px;
      line-height:1.5;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .choiceBtn:active{transform:scale(.99)}
    .choiceBtn[disabled]{opacity:.55; cursor:not-allowed;}
    .choiceBtn.correct{border-color:rgba(40,199,111,.65); background:rgba(40,199,111,.14);}
    .choiceBtn.wrong{border-color:rgba(255,77,79,.65); background:rgba(255,77,79,.14);}
    .resultTitle{
      font-size:16px;
      margin:0 0 8px 0;
      display:flex; align-items:center; gap:8px; flex-wrap:wrap;
    }
    .tag{
      font-size:12px; padding:3px 8px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06);
      color:var(--muted);
    }
    .bigAnswer{
      font-size:22px;
      line-height:1.55;
      padding:10px 12px;
      border-radius:14px;
      border:1px dashed rgba(255,255,255,.20);
      background:rgba(0,0,0,.12);
      margin:8px 0 10px;
    }
    .kv{display:grid; grid-template-columns: 120px 1fr; gap:8px 10px; align-items:start;}
    .k{color:var(--muted); font-size:12px;}
    .v{font-size:14px; line-height:1.6;}
    .warn{color:var(--warn);}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;}
    .stats{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px;}
    @media (min-width:760px){ .stats{grid-template-columns: repeat(4, minmax(0,1fr));} }
    .stat{padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04);}
    .stat .n{font-size:18px; margin-top:4px;}
    .footerNote{color:var(--muted); font-size:12px; margin-top:10px; line-height:1.6;}
    .kbd{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      font-size:12px; padding:1px 6px; border:1px solid rgba(255,255,255,.16);
      border-radius:8px; background:rgba(0,0,0,.18);
    }
    table{width:100%; border-collapse:collapse; margin-top:8px; font-size:13px;}
    th, td{border-bottom:1px solid rgba(255,255,255,.10); padding:8px 6px; text-align:left; vertical-align:top;}
    th{color:var(--muted); font-weight:600;}
    .right{text-align:right;}

    /* ===== è¡¨å½°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆãƒ‰ãƒ¼ãƒ³ï¼ï¼‰ ===== */
    .overlay{
      position:fixed; inset:0;
      display:none;
      background:rgba(3,6,14,.92);
      z-index:1000;
      padding:16px;
    }
    .overlay.show{display:block;}
    .award{
      max-width:860px;
      margin:0 auto;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(800px 300px at 50% -20%, rgba(122,162,255,.30), transparent 60%),
        radial-gradient(600px 260px at 10% 0%, rgba(255,209,102,.20), transparent 60%),
        radial-gradient(600px 260px at 90% 0%, rgba(205,215,255,.16), transparent 60%),
        rgba(17,26,46,.90);
      box-shadow:0 20px 80px rgba(0,0,0,.55);
      padding:18px 16px 16px;
      position:relative;
      overflow:hidden;
    }
    .awardTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .awardTitle{
      font-size:20px; letter-spacing:.03em; margin:0;
    }
    .awardScore{
      font-size:40px;
      line-height:1.1;
      font-weight:800;
      letter-spacing:.02em;
      margin:10px 0 10px;
    }
    .awardMsg{
      font-size:18px;
      line-height:1.6;
      margin:8px 0 10px;
    }
    .awardMeta{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      color:var(--muted); font-size:12px;
    }

    /* ãƒãƒƒã‚¸ï¼ˆLv10/9/8æ´¾æ‰‹ï¼‰ */
    .badge{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06);
      font-weight:800;
      letter-spacing:.03em;
    }
    .badge .star{font-size:18px;}
    .badge.lv10{
      border-color:rgba(255,209,102,.55);
      background:linear-gradient(90deg, rgba(255,209,102,.30), rgba(122,162,255,.20));
      box-shadow:0 0 0 1px rgba(255,209,102,.15), 0 0 40px rgba(255,209,102,.18);
      animation:pulse 1.2s ease-in-out infinite;
    }
    .badge.lv9{
      border-color:rgba(205,215,255,.55);
      background:linear-gradient(90deg, rgba(205,215,255,.26), rgba(122,162,255,.18));
      box-shadow:0 0 0 1px rgba(205,215,255,.14), 0 0 34px rgba(205,215,255,.16);
      animation:pulse 1.35s ease-in-out infinite;
    }
    .badge.lv8{
      border-color:rgba(255,179,193,.55);
      background:linear-gradient(90deg, rgba(255,179,193,.22), rgba(122,162,255,.16));
      box-shadow:0 0 0 1px rgba(255,179,193,.12), 0 0 28px rgba(255,179,193,.14);
      animation:pulse 1.5s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{transform:translateY(0); filter:brightness(1);}
      50%{transform:translateY(-2px); filter:brightness(1.08);}
    }

    /* ã‚­ãƒ©ã‚­ãƒ©èƒŒæ™¯ */
    .spark{
      position:absolute;
      inset:-40px;
      background:
        radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(2px 2px at 22% 35%, rgba(255,209,102,.55), transparent 60%),
        radial-gradient(2px 2px at 35% 18%, rgba(205,215,255,.55), transparent 60%),
        radial-gradient(2px 2px at 55% 30%, rgba(255,179,193,.50), transparent 60%),
        radial-gradient(2px 2px at 75% 22%, rgba(255,255,255,.45), transparent 60%),
        radial-gradient(2px 2px at 88% 40%, rgba(122,162,255,.45), transparent 60%),
        radial-gradient(2px 2px at 15% 70%, rgba(255,255,255,.40), transparent 60%),
        radial-gradient(2px 2px at 45% 80%, rgba(255,209,102,.40), transparent 60%),
        radial-gradient(2px 2px at 80% 76%, rgba(205,215,255,.40), transparent 60%);
      opacity:.35;
      animation:drift 6s linear infinite;
      pointer-events:none;
    }
    @keyframes drift{
      0%{transform:translateY(0);}
      100%{transform:translateY(28px);}
    }

    .awardGrid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
      margin-top:12px;
    }
    @media (min-width:760px){
      .awardGrid{grid-template-columns:1fr 1fr;}
    }
    .awardBox{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.12);
      border-radius:18px;
      padding:12px;
    }
    .awardBox .t{color:var(--muted); font-size:12px;}
    .awardBox .v{font-size:16px; margin-top:6px; line-height:1.6;}
  </style>
</head>
<body>
<header>
  <h1>ï¼’å¹´ï¼’çµ„å¿…å‹ã€€ç™¾äººä¸€é¦–æš—è¨˜ã‚½ãƒ•ãƒˆ</h1>
  <div class="sub">
    <span class="pill" id="modePill">ãƒ¢ãƒ¼ãƒ‰ï¼šé€šå¸¸</span>
    <span class="pill" id="indexPill">â€”</span>
    <span class="pill" id="scorePill">æ­£è§£ç‡ï¼šâ€”</span>
    <span class="pill" id="streakPill">é€£ç¶šï¼šâ€”</span>
    <span class="pill" id="setPill">ã‚»ãƒƒãƒˆï¼šâ€”</span>
    <span class="pill" id="bestPill">ãƒ™ã‚¹ãƒˆï¼šâ€”</span>
  </div>
</header>

<main>
  <div class="row">
    <button class="btn primary" id="btnNext">æ¬¡ã¸ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰</button>
    <button class="btn" id="btnStartSet">20å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸é–‹å§‹</button>

    <select class="select" id="modeSel">
      <option value="normal">é€šå¸¸ï¼ˆå…¨éƒ¨ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ï¼‰</option>
      <option value="weak">è‹¦æ‰‹å¾©ç¿’ï¼ˆâŒå¤šã‚ã‚’å„ªå…ˆï¼‰</option>
      <option value="unseen">æœªæŒ‘æˆ¦ï¼ˆã¾ã è§£ã„ã¦ãªã„æ­Œï¼‰</option>
    </select>

    <button class="btn small" id="btnReset">è¨˜éŒ²ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <div class="card" id="quizCard">
    <div class="label">ä¸Šã®å¥ï¼ˆã“ã‚Œã‚’èã„ãŸã‚‰ä¸‹ã®å¥ï¼ï¼‰</div>
    <div class="kami" id="kami">â€”</div>

    <div class="choices" id="choices"></div>

    <div class="footerNote">
      <span class="kbd">20å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸</span>ä¸­ã¯ã€Œã‚»ãƒƒãƒˆã€ãŒé€²ã‚€ã€‚20å•ç›®ã§<span class="kbd">è¡¨å½°</span>ãŒãƒ‰ãƒ¼ãƒ³ï¼<br/>
      åˆ¤å®šå¾Œã«<span class="kbd">æ±ºã¾ã‚Šå­—</span>ã¨<span class="kbd">èªå‘‚</span>ãŒå‡ºã‚‹ã€‚
    </div>
  </div>

  <div class="card" id="resultCard" style="display:none;">
    <h2 class="resultTitle" id="resultTitle">â€”</h2>
    <div class="bigAnswer" id="correctAnswer">â€”</div>

    <div class="kv">
      <div class="k">ã‚»ãƒƒãƒˆçµæœ</div><div class="v" id="setResultLine">â€”</div>
      <div class="k">æ±ºã¾ã‚Šå­—</div><div class="v" id="kimariji">â€”</div>
      <div class="k">èªå‘‚åˆã‚ã›</div><div class="v" id="goro">â€”</div>
      <div class="k">å…¨æ–‡</div><div class="v" id="fullwaka">â€”</div>
      <div class="k">ç•ªå·</div><div class="v mono" id="no">â€”</div>
    </div>

    <div class="row" style="margin-top:12px;">
      <button class="btn primary" id="btnNext2">æ¬¡ã¸</button>
      <button class="btn" id="btnShowAgain">åŒã˜æ­Œã§ã‚‚ã†ä¸€å›</button>
    </div>
  </div>

  <div class="card">
    <div class="label">å­¦ç¿’çŠ¶æ³</div>
    <div class="stats">
      <div class="stat"><div class="label">è§£ç­”æ¸ˆã¿</div><div class="n" id="stDone">â€”</div></div>
      <div class="stat"><div class="label">æ­£è§£ âœ…</div><div class="n" id="stGood">â€”</div></div>
      <div class="stat"><div class="label">ä¸æ­£è§£ âŒ</div><div class="n" id="stBad">â€”</div></div>
      <div class="stat"><div class="label">æ­£è§£ç‡</div><div class="n" id="stRate">â€”</div></div>
    </div>
    <div class="footerNote">â€»å­¦ç¿’è¨˜éŒ²ãƒ»å±¥æ­´ã¯ç«¯æœ«å†…ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼‰ã«ä¿å­˜ã•ã‚Œã‚‹ã€‚</div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between;">
      <div class="label" style="margin:0;">20å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸å±¥æ­´ï¼ˆæœ€æ–°ãŒä¸Šï¼‰</div>
      <button class="btn small danger" id="btnClearHistory">å±¥æ­´ã‚’æ¶ˆã™</button>
    </div>
    <div id="historyWrap" class="footerNote" style="margin-top:6px;">â€”</div>
  </div>
</main>

<!-- ===== è¡¨å½°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ ===== -->
<div class="overlay" id="awardOverlay" aria-hidden="true">
  <div class="award" role="dialog" aria-modal="true">
    <div class="spark" aria-hidden="true"></div>

    <div class="awardTop">
      <div>
        <div class="badge" id="awardBadge"><span class="star">â˜…</span><span id="awardBadgeText">Lv.â€” ç§°å·</span></div>
      </div>
      <button class="btn primary" id="btnCloseAward">ç¶šã‘ã‚‹ï¼ˆæ¬¡ã¸ï¼‰</button>
    </div>

    <h2 class="awardTitle">20å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ çµæœç™ºè¡¨</h2>
    <div class="awardScore" id="awardScore">â€”</div>
    <div class="awardMsg" id="awardMsg">â€”</div>

    <div class="awardMeta">
      <span class="pill" id="awardWhen">â€”</span>
      <span class="pill" id="awardBestNow">â€”</span>
    </div>

    <div class="awardGrid">
      <div class="awardBox">
        <div class="t">ã‚ãªãŸã®çµæœ</div>
        <div class="v" id="awardLine">â€”</div>
      </div>
      <div class="awardBox">
        <div class="t">ãƒ™ã‚¹ãƒˆè¨˜éŒ²</div>
        <div class="v" id="awardBestDetail">â€”</div>
      </div>
    </div>

    <div class="footerNote" style="margin-top:10px;">
      â€»Lv10/9/8ã¯ã€Œç§°å·ãƒãƒƒã‚¸ã€ãŒæ´¾æ‰‹æ¼”å‡ºã€‚ã‚¯ãƒ©ã‚¹ã§å‹è² ã™ã‚‹ã¨ç››ã‚Œã‚‹ã€‚<br/>
      ãƒ’ãƒ³ãƒˆï¼šãƒ™ã‚¹ãƒˆæ›´æ–°ã‚’ç›®æŒ‡ã™ãªã‚‰ã€Œè‹¦æ‰‹å¾©ç¿’ã€â†’ã€Œ20å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã€ã®æµã‚ŒãŒå¼·ã„ã€‚
    </div>
  </div>
</div>

<script>
/* =========================
   ãƒ‡ãƒ¼ã‚¿ï¼ˆ100é¦–ï¼‰ â€»ã“ã“ã¯å‰ã¨åŒã˜
   ========================= */
const RAW_TSV = `ç•ªå·\tå’Œæ­Œ\tæ±ºã¾ã‚Šå­—ï¼ˆçŸ­ç¸®ï¼‰\tèªå‘‚åˆã‚ã›
1\tç§‹ã®ç”°ã® ã‹ã‚Šã»ã®åºµã® è‹«ã‚’ã‚ã‚‰ã¿ ã‚ãŒè¡£æ‰‹ã¯ éœ²ã«ã¬ã‚Œã¤ã¤\tã‚ãã® ã‚ãŒã“ã‚ã‚‚ã§ã¯\tç§‹ã®ã‚ãŒè¡£ã§ã¯
2\tæ˜¥éãã¦ å¤æ¥ã«ã‘ã‚‰ã— ç™½å¦™ã® è¡£ã»ã™ã¦ãµ å¤©ã®é¦™å…·å±±\tã¯ã‚‹ã™ã ã“ã‚ã‚‚ã»ã™\tæ˜¥éãã€è¡£å¹²ã™
3\tã‚ã—ã³ãã® å±±é³¥ã®å°¾ã® ã—ã ã‚Šå°¾ã® é•·ã€…ã—å¤œã‚’ ç‹¬ã‚Šã‹ã‚‚å¯ã‚€\tã‚ã— ãªãŒãªãŒ\tè¶³ãªãŒãªãŒ
4\tç”°å­ã®æµ¦ã« ã†ã¡å‡ºã§ã¦ã¿ã‚Œã° ç™½å¦™ã® å¯Œå£«ã®é«˜å¶ºã« é›ªã¯é™ã‚Šã¤ã¤\tãŸã”ã® ãµã˜\tç”°å­ã®å¯Œå£«
5\tå¥¥å±±ã« ç´…è‘‰è¸ã¿åˆ†ã‘ é³´ãé¹¿ã® å£°èãæ™‚ã ç§‹ã¯æ‚²ã—ã\tãŠã ã“ãˆ\tç½®ãå£°
6\tã‹ã•ã•ãã® æ¸¡ã›ã‚‹æ©‹ã« ãŠãéœœã® ç™½ãã‚’è¦‹ã‚Œã° å¤œãæ›´ã‘ã«ã‘ã‚‹\tã‹ã•ã¯ ã—ã‚\tå‚˜ã¯ç™½
7\tå¤©ã®åŸ ãµã‚Šã•ã‘è¦‹ã‚Œã° æ˜¥æ—¥ãªã‚‹ ä¸‰ç¬ ã®å±±ã« å‡ºã§ã—æœˆã‹ã‚‚\tã‚ã¾ã® ã¿ã‹ï¼Ÿ\tå¤©ã®å®Ÿã‹ï¼Ÿ
8\tæˆ‘ãŒåºµã¯ éƒ½ã®è¾°å·³ ã—ã‹ãä½ã‚€ ä¸–ã‚’ã†ã¢å±±ã¨ äººã¯ã„ãµãªã‚Š\tã‚ãŒã„ ã‚ˆã‚’ã†ã—\tã‚ãŒæ„ã€ä¸–ã‚’æ†‚ã—
9\tèŠ±ã®è‰²ã¯ ç§»ã‚Šã«ã‘ã‚Šãª ã„ãŸã¥ã‚‰ã« æˆ‘ãŒèº«ä¸–ã«ãµã‚‹ ãªãŒã‚ã›ã—é–“ã«\tã¯ãªã® ã‚ãŒã¿ã‚ˆ\tèŠ±ã®æˆ‘ãŒèº«ã‚ˆ
10\tã“ã‚Œã‚„ã“ã® è¡Œãã‚‚å¸°ã‚‹ã‚‚ åˆ¥ã‚Œã¦ã¯ çŸ¥ã‚‹ã‚‚çŸ¥ã‚‰ã¬ã‚‚ é€¢å‚ã®é–¢\tã“ã‚Œ ã—ã‚‹\tã“ã‚ŒçŸ¥ã‚‹
11\tã‚ãŸã®åŸ å…«åå³¶ã‹ã‘ã¦ æ¼•ãå‡ºã§ã¬ã¨ äººã«ã¯å‘Šã’ã‚ˆ æµ·äººã®é‡£ã‚ŠèˆŸ\tã‚ãŸã®ã¯ã‚‰ã‚„ ã²ã¨ã«ã¯ã¤ã’ã‚ˆ\tã‚ãŸã®åŸã‚„ã€äººã«ã¯å‘Šã’ã‚ˆ
12\tå¤©ã¤é¢¨ é›²ã®é€šã²è·¯ å¹ãé–‰ã¢ã‚ˆ ã‚’ã¨ã‚ã®å§¿ ã—ã°ã—ã¨ã©ã‚ã‚€\tã‚ã¾ã¤ ãŠã¨ã‚\tå¤©æ´¥ä¹™å¥³
13\tç­‘æ³¢å¶ºã® å³°ã‚ˆã‚Šè½ã¤ã‚‹ ç”·å¥³å· æ‹ãã¤ã‚‚ã‚Šã¦ æ·µã¨ãªã‚Šã¬ã‚‹\tã¤ã ã“ã„ã\tçªãé¯‰ã
14\té™¸å¥¥ã® ã—ã®ã¶ã‚‚ã¢ãšã‚Š èª°ã‚†ã‚‘ã« ä¹±ã‚Œãã‚ã«ã— æˆ‘ãªã‚‰ãªãã«\tã¿ã¡ ã¿ã ã‚Œãã†\té“ã€ä¹±ã‚Œãã†
15\tå›ãŒãŸã‚ æ˜¥ã®é‡ã«å‡ºã§ã¦ è‹¥èœæ‘˜ã‚€ æˆ‘ãŒè¡£æ‰‹ã« é›ªã¯é™ã‚Šã¤ã¤\tãã¿ãŒãŸã‚ã¯ ã‚ãŒã“ã‚ã‚‚ã§ã«\tå›ãŒãŸã‚ã¯ã€æˆ‘ãŒè¡£æ‰‹ã«
16\tç«‹ã¡ã‚ã‹ã‚Œ ã„ãªã°ã®å±±ã® å³°ã«ç”Ÿãµã‚‹ ã¾ã¤ã¨ã—èã‹ã° ä»Šå¸°ã‚Šæ¥ã‚€\tãŸã¡ ã¾ã¤ã¨\tç«‹ã¡å¾…ã¤ã¨
17\tã¡ã¯ã‚„ã¶ã‚‹ ç¥ä»£ã‚‚èã‹ãš é¾ç”°å· å”ç´…ã« æ°´ããã‚‹ã¨ã¯\tã¡ã¯ã‚„ ã‹ã‚‰\tåƒæ—©ã‹ã‚‰
18\tä½ã®æ±Ÿã® å²¸ã«å¯„ã‚‹æ³¢ ã‚ˆã‚‹ã•ã¸ã‚„ å¤¢ã®é€šã²è·¯ äººç›®ã‚ˆãã‚‰ã‚€\tã™ã¿ã® ã‚†ã‚\tç‚­ã®å¤¢
19\té›£æ³¢æ½Ÿ çŸ­ãèŠ¦ã® ç¯€ã®é–“ã‚‚ é€¢ã¯ã§ã“ã®ä¸–ã‚’ éãã—ã¦ã‚ˆã¨ã‚„\tãªã«ã‚ãŒ ã‚ã‚ã§\té›£æ³¢ãŒæ³¡ã§
20\tã‚ã³ã¬ã‚Œã° ä»Šã¯ãŸåŒã˜ é›£æ³¢ãªã‚‹ ã¿ã‚’ã¤ãã—ã¦ã‚‚ é€¢ã¯ã‚€ã¨ãæ€ãµ\tã‚ã³ã‚‹ ã¿ã‚’ã¤ãã—ã¦ã‚‚\tè©«ã³ã‚‹ã€èº«ã‚’å°½ãã—ã¦ã‚‚
21\tä»Šæ¥ã‚€ã¨ ã„ã²ã—ã°ã‹ã‚Šã« é•·æœˆã® æœ‰ã‚Šæ˜ã‘ã®æœˆã‚’ å¾…ã¡å‡ºã§ã¤ã‚‹ã‹ãª\tã„ã¾ã“ ã‚ã‚Š\tä»Šå­èŸ»
22\tå¹ãã‹ã‚‰ã« ç§‹ã®è‰æœ¨ã® ã—ã‚’ã‚‹ã‚Œã° ã‚€ã¹å±±é¢¨ã‚’ åµã¨ã„ãµã‚‰ã‚€\tãµ ã‚€ã¹\tè¸ã‚€ã¹
23\tæœˆè¦‹ã‚Œã° ã¡ã¢ã«ç‰©ã“ã æ‚²ã—ã‘ã‚Œ æˆ‘ãŒèº«ä¸€ã¤ã® ç§‹ã«ã¯ã‚ã‚‰ã­ã©\tã¤ã ã‚ãŒã¿ã²ã¨ã¤\tæœˆã€ã‚ãŒèº«ä¸€ã¤
24\tã“ã®ãŸã³ã¯ å¹£ã‚‚ã¨ã‚Šã‚ã¸ãš æ‰‹å‘å±± ç´…è‘‰ã®éŒ¦ ç¥ã®ã¾ã«ã¾ã«\tã“ã® ã‚‚ã¿ã˜\tã“ã®ç´…è‘‰
25\tåã«ã—è² ã¯ã° é€¢å‚å±±ã® ã•ã­ã‹ã¥ã‚‰ äººã«çŸ¥ã‚‰ã‚Œã§ ãã‚‹ã‚ˆã—ã‚‚ãŒãª\tãªã«ã— ã²ã¨ã«ã—\tä½•ã—ã€äººã«ã—
26\tå°å€‰å±± å³°ã®ã‚‚ã¿ã¢è‘‰ å¿ƒã‚ã‚‰ã° ä»Šä¸€åº¦ã® è¡Œå¹¸å¾…ãŸãªã‚€\tãŠãã‚‰ã‚„ã¾ ã„ã¾ã²ã¨ãŸã³ã®ã¿ã‚†ã\tå°å€‰å±±ä»Šä¸€åº¦ã®æ·±é›ª
27\tã¿ã‹ã®åŸ ã‚ãã¦æµã‚‹ã‚‹ ã„ã¥ã¿å· ã„ã¤è¦‹ãã¨ã¦ã‹ æ‹ã—ã‹ã‚‹ã‚‰ã‚€\tã¿ã‹ã®ã¯ã‚‰ ã„ã¤ã¿ãã\tã¿ã‹ã®åŸã„ã¤è¦‹èãï¼Ÿ
28\tå±±é‡Œã¯ å†¬ãå¯‚ã—ã• ã¾ã•ã‚Šã‘ã‚‹ äººç›®ã‚‚è‰ã‚‚ ã‹ã‚Œã¬ã¨æ€ã¸ã°\tã‚„ã¾ã–ã¨ ã²ã¨ã‚\tå±±é‡Œã€ã²ã¨ç›®
29\tå¿ƒã‚ã¦ã« æŠ˜ã‚‰ã°ã‚„æŠ˜ã‚‰ã‚€ åˆéœœã® ç½®ãã¾ã©ã¯ã›ã‚‹ ç™½èŠã®èŠ±\tã“ã“ã‚ ã‚ãŠ\tã“ã“ã‚é’
30\tæœ‰ã‚Šæ˜ã‘ã® ã¤ã‚Œãªãè¦‹ãˆã— åˆ¥ã‚Œã‚ˆã‚Š æšã°ã‹ã‚Š æ†‚ãã‚‚ã®ã¯ãªã—\tã‚ã‚Šã‚ƒ ã‚ã‹\tã‚ã‚Šã‚ƒã€èµ¤
31\tæœã¼ã‚‰ã‘ æœ‰ã‚Šæ˜ã‘ã®æœˆã¨ è¦‹ã‚‹ã¾ã§ã« å‰é‡ã®é‡Œã« é™ã‚Œã‚‹ç™½é›ª\tã‚ã•ã¼ã‚‰ã‘ã‚ã‚Šã‚ã‘ã® ã‚ˆã—ã®\tæœã¼ã‚‰ã‘æœ‰æ˜ã®å‰é‡
32\tå±±å·ã« é¢¨ã®ã‹ã‘ãŸã‚‹ æŸµã¯ æµã‚Œã‚‚ã‚ã¸ã¬ ç´…è‘‰ãªã‚Šã‘ã‚Š\tã‚„ã¾ãŒ ãªãŒã‚Œã‚‹\tå±±ãŒæµã‚Œã‚‹
33\tä¹…æ–¹ã® å…‰ã®ã©ã‘ã æ˜¥ã®æ—¥ã« ã—ã¥å¿ƒãªã èŠ±ã®æ•£ã‚‹ã‚‰ã‚€\tã²ã•ã‹ãŸã® ã—ã¥\tä¹…æ–¹ã®é™
34\tèª°ã‚’ã‹ã‚‚ çŸ¥ã‚‹äººã«ã›ã‚€ é«˜ç ‚ã® æ¾ã‚‚æ˜”ã® å‹ãªã‚‰ãªãã«\tãŸã‚Œã¾ã¤ã‚‚ ã‚€ã‹ã—\tèª°å¾…ã¤ã‚‚æ˜”
35\täººã¯ã„ã• å¿ƒã‚‚çŸ¥ã‚‰ãš ãµã‚‹ã•ã¨ã¯ èŠ±ãæ˜”ã® é¦™ã«ã«ã»ã²ã‘ã‚‹\tã²ã¨ã¯ ã¯ãªã\täººã¯èŠ±ã
36\tå¤ã®å¤œã¯ ã¾ã å®µãªãŒã‚‰ æ˜ã‘ã¬ã‚‹ã‚’ é›²ã®ã„ã¥ã“ã« æœˆå®¿ã‚‹ã‚‰ã‚€\tãªã¤ ãã‚‚ã®\tæ‡ãã‚‚ã®
37\tç™½éœ²ã« é¢¨ã®å¹ãã—ã ç§‹ã®é‡ã¯ è²«ãæ­¢ã‚ã¬ ç‰ãæ•£ã‚Šã‘ã‚‹\tã—ã‚‰ ã¤ã‚‰\tã—ã‚‰ã¤ã‚‰
38\tå¿˜ã‚‰ã‚‹ã‚‹ èº«ã‚’ã°æ€ã¯ãš èª“ã²ã¦ã— äººã®å‘½ã® æƒœã—ãã‚‚ã‚ã‚‹ã‹ãª\tã‚ã™ã‚‰ã‚‹ã‚‹ ã²ã¨ã®ã„ã®ã¡\tå¿˜ã‚‰ã‚‹ã‚‹äººã®å‘½
39\tæµ…èŒ…ç”Ÿã® å°é‡ã®ç¯ åŸ å¿ã‚Œã© ã‚ã¾ã‚Šã¦ãªã©ã‹ äººã®æ‹ã—ã\tã‚ã• ã˜ã‚…ã†ã‚ã¾ã‚Š\tæœã€åã‚ã¾ã‚Š
40\tå¿ã‚Œã© è‰²ã«å‡ºã§ã«ã‘ã‚Š æˆ‘ãŒæ‹ã¯ ç‰©ã‚„æ€ãµã¨ äººã®å•ãµã¾ã§\tã—ã® ã‚‚ã®\tã—ã®ã‚‚ã®
41\tæ‹ã™ã¦ãµ æˆ‘ãŒåã¯ã¾ã ã ç«‹ã¡ã«ã‘ã‚Š äººçŸ¥ã‚Œãšã“ã æ€ã²åˆã‚ã—ã‹\tã“ã„ ã²ã¨ã—ã‚Œãš\tæ¥ã„ã€äººçŸ¥ã‚Œãš
42\tå¥‘ã‚Šããª ã‹ãŸã¿ã«è¢–ã‚’ ã—ã¼ã‚Šã¤ã¤ æœ«ã®æ¾å±± æ³¢è¶Šã•ã˜ã¨ã¯\tã¡ãã‚Šããª ã™ãˆã®ã¾ã¤ã‚„ã¾\tã¡ãã‚Šããªæœ«ã®æ¾å±±
43\té€¢ã²è¦‹ã¦ã® å¾Œã®å¿ƒã« æ¯”ã¶ã‚Œã° æ˜”ã¯ç‰©ã‚’ æ€ã¯ã–ã‚Šã‘ã‚Š\tã‚ã„ ã‚€ã‹ã—\tæ„›ã€æ˜”
44\té€¢ãµã“ã¨ã® çµ¶ãˆã¦ã—ãªãã¯ ãªã‹ãªã‹ã« äººã‚’ã‚‚èº«ã‚’ã‚‚ æ¨ã¿ã–ã‚‰ã¾ã—\tã‚ã†ã“ã¨ ã²ã¨ã‚’\tä¼šã†ã“ã¨ã€äººã‚’
45\tã‚ã¯ã‚Œã¨ã‚‚ ã„ãµã¹ãäººã¯ æ€ã»ãˆã§ èº«ã®ã„ãŸã¥ã‚‰ã« ãªã‚Šã¬ã¹ãã‹ãª\tã‚ã‚ã‚Œ ã¿ã®\tå“€ã‚Œã¿ã®
46\tç”±è‰¯ã®é–€ã‚’ æ¸¡ã‚‹èˆŸäºº ã‹ã¢ã‚’çµ¶ãˆ ã‚†ãã¸ã‚‚çŸ¥ã‚‰ã¬ æ‹ã®é“ã‹ãª\tã‚†ã‚‰ ã‚†ã\tã‚†ã‚‰ã‚†ã
47\tå…«é‡è‘ èŒ‚ã‚Œã‚‹å®¿ã® ã•ã³ã—ãã« äººã“ãè¦‹ãˆã­ ç§‹ã¯æ¥ã«ã‘ã‚Š\tã‚„ãˆã§ ã²ã¨ã“ãã¿ãˆã­ã‡\tå…«é‡ã§äººã“ãè¦‹ãˆã­ã‡
48\té¢¨ã‚’ã„ãŸã¿ å²©æ‰“ã¤æ³¢ã® ãŠã®ã‚Œã®ã¿ ãã ã‘ã¦ç‰©ã‚’ æ€ãµé ƒã‹ãª\tã‹ãœã‚’ ãã ã‘\té¢¨ã‚’ãã ã‘
49\tã¿ã‹ãå®ˆ è¡›å£«ã®ãŸãç«ã® å¤œã¯ç‡ƒãˆ æ˜¼ã¯æ¶ˆãˆã¤ã¤ ç‰©ã‚’ã“ãæ€ã¸\tã¿ãŒãã‚‚ ã²ã‚‹\tç£¨ãã‚‚æ˜¼
50\tå›ãŒãŸã‚ æƒœã—ã‹ã‚‰ã–ã‚Šã— å‘½ã•ã¸ é•·ãã‚‚ãŒãªã¨ æ€ã²ã‘ã‚‹ã‹ãª\tãã¿ãŒãŸã‚ã€ãŠ ãªãŒã\tå›ãŒãŸã‚ã€å°¾é•·ã
51\tã‹ãã¨ã ã« ãˆã‚„ã¯ã„ã¶ãã® ã•ã—ã‚‚è‰ ã•ã—ã‚‚çŸ¥ã‚‰ã˜ãª ç‡ƒã‚†ã‚‹æ€ã²ã‚’\tã‹ã ã•\tæ›¸ãã•
52\tæ˜ã‘ã¬ã‚Œã° æš®ã‚‹ã‚‹ã‚‚ã®ã¨ã¯ çŸ¥ã‚ŠãªãŒã‚‰ ãªã»æ¨ã‚ã—ã æœã¼ã‚‰ã‘ã‹ãª\tã‚ã‘ãª ã»ã‰ã‚‰\té–‹ã‘ãªã€ã»ã‰ã‚‰
53\tå˜†ãã¤ã¤ ç‹¬ã‚Šå¯ã‚‹å¤œã® æ˜ãã‚‹é–“ã¯ ã„ã‹ã«ä¹…ã—ã ã‚‚ã®ã¨ã‹ã¯çŸ¥ã‚‹\tãªã’ã ã‚¤ã‚«\tå˜†ãã‚¤ã‚«
54\tå¿˜ã‚Œã˜ã® è¡Œãæœ«ã¾ã§ã¯ é›£ã‘ã‚Œã° ä»Šæ—¥ã‚’é™ã‚Šã® å‘½ã¨ã‚‚ãŒãª\tã‚ã™ã‚Œã˜ ãã‚‡ã†ã‚’\tå¿˜ã‚Œã˜ä»Šæ—¥ã‚’
55\tæ»ã®éŸ³ã¯ çµ¶ãˆã¦ä¹…ã—ã ãªã‚Šã¬ã‚Œã© åã“ãæµã‚Œã¦ ãªã»èã“ãˆã‘ã‚Œ\tãŸãã® ãªã“ã\tæ»ã®åã“ã
56\tã‚ã‚‰ã–ã‚‰ã‚€ ã“ã®ä¸–ã®å¤–ã® æ€ã²å‡ºã« ä»Šä¸€åº¦ã® é€¢ãµã“ã¨ã‚‚ãŒãª\tã‚ã‚‰ã–ã‚‰ã‚“ ã„ã¾ã²ã¨ãŸã³ã®ã‚ã†\tã‚ã‚‰ã–ã‚‰ã‚“ä»Šä¸€åº¦ã®ä¼šã†
57\tã‚ãã‚Šé€¢ã²ã¦ è¦‹ã—ã‚„ãã‚Œã¨ã‚‚ ã‚ã‹ã¬é–“ã« é›²éš ã‚Œã«ã— å¤œåŠã®æœˆã‹ãª\tãƒ¡ã‚° ãã‚‚ãŒãã‚Œ\tãƒ¡ã‚°ã€é›²éš ã‚Œ
58\tæœ‰é¦¬å±± çŒªåã®ç¬¹åŸ é¢¨å¹ã‘ã° ã„ã§ãã‚ˆäººã‚’ å¿˜ã‚Œã‚„ã¯ã™ã‚‹\tã‚ã‚Šã¾ ã„ãƒ¼ã§\tæœ‰é¦¬ã€ã„ãƒ¼ã§
59\tã‚„ã™ã‚‰ã¯ã§ å¯ãªã¾ã—ã‚‚ã®ã‚’ ã•å¤œæ›´ã‘ã¦ å‚¾ãã¾ã§ã® æœˆã‚’è¦‹ã—ã‹ãª\tã‚„ã™ ã‹ã£ãŸ\tå®‰ã‹ã£ãŸ
60\tå¤§æ±Ÿå±± ã„ãé‡ã®é“ã® é ã‘ã‚Œã° ã¾ã ãµã¿ã‚‚è¦‹ãš å¤©ã®æ©‹ç«‹\tãŠãŠãˆ ã¾ã ï¼Ÿ\tå¤§æ±Ÿã€ã¾ã ï¼Ÿ
61\tã„ã«ã—ãˆã® å¥ˆè‰¯ã®éƒ½ã® å…«é‡æ¡œ ä»Šæ—¥ä¹é‡ã« ã«ã»ã²ã¬ã‚‹ã‹ãª\tã„ã«ã—ãˆã® ãã‚‡ã†ã“\tå¤ã®äº¬å­
62\tå¤œã‚’ã“ã‚ã¦ é³¥ã®ç©ºéŸ³ã¯ ã¯ã‹ã‚‹ã¨ã‚‚ ã‚ˆã«é€¢å‚ã® é–¢ã¯è¨±ã•ã˜\tã‚ˆã‚’ ã‚ˆã«\tã‚ˆã‚’ã‚ˆã«
63\tä»Šã¯ãŸã  æ€ã²çµ¶ãˆãªã‚€ ã¨ã°ã‹ã‚Šã‚’ äººã¥ã¦ãªã‚‰ã§ è¨€ãµã‚ˆã—ã‚‚ãŒãª\tã„ã¾ã¯ ã²ã¨ã¤\tä»Šã¯ä¸€ã¤
64\tæœã¼ã‚‰ã‘ å®‡æ²»ã®å·éœ§ ãŸãˆã ãˆã« ã‚ã‚‰ã¯ã‚Œæ¸¡ã‚‹ ç€¬ã€…ã®ç¶²ä»£æœ¨\tã‚ã•ã¼ã‚‰ã‘ã†ã˜ ã‚ã‚‰ã‚ã‚Œã‚‹\tæœã¼ã‚‰ã‘å®‡æ²»ã€ç¾ã‚Œã‚‹
65\tæ¨ã¿ã‚ã³ ã»ã•ã¬è¢–ã ã« ã‚ã‚‹ã‚‚ã®ã‚’ æ‹ã«æœ½ã¡ãªã‚€ åã“ãæƒœã—ã‘ã‚Œ\tã†ã‚‰ã® ã“ã„ã«\tè£ã®é¯‰ã«
66\tã‚‚ã‚ã¨ã‚‚ã« ã‚ã¯ã‚Œã¨æ€ã¸ å±±æ¡œ èŠ±ã‚ˆã‚Šå¤–ã« çŸ¥ã‚‹äººã‚‚ãªã—\tã‚‚ã‚ã¨ã‚‚ã« ã¯ãªã‚ˆ\tã‚‚ã‚ã¨ã‚‚ã«èŠ±ã‚ˆ
67\tæ˜¥ã®å¤œã® å¤¢ã°ã‹ã‚Šãªã‚‹ æ‰‹æ•ã« ã‹ã²ãªãç«‹ãŸã‚€ åã“ãæƒœã—ã‘ã‚Œ\tã¯ã‚‹ã® ã‹ã„\tæ˜¥ã®è²
68\tå¿ƒã«ã‚‚ ã‚ã‚‰ã§æ†‚ãä¸–ã« ãªãŒã‚‰ã¸ã° æ‹ã—ã‹ã‚‹ã¹ã å¤œåŠã®æœˆã‹ãª\tã“ã“ã‚ã« ã“ã„ã—\tå¿ƒã«å°çŸ³
69\tåµå¹ã ä¸‰å®¤ã®å±±ã® ã‚‚ã¿ã¢è‘‰ã¯ é¾ç”°ã®å·ã® éŒ¦ãªã‚Šã‘ã‚Š\tã‚ã‚‰ã— ãŸã¤\tåµãŸã¤
70\tã•ã³ã—ã•ã« å®¿ã‚’ç«‹ã¡å‡ºã§ã¦ çœºã‚€ã‚Œã° ã„ã¥ã“ã‚‚åŒã˜ ç§‹ã®å¤•æš®ã‚Œ\tã•ã ã„ã¥ã“ï¼Ÿ\tã•ãã€ã„ã¥ã“ï¼Ÿ
71\tå¤•ã•ã‚Œã° é–€ç”°ã®ç¨²è‘‰ ãŠã¨ã¥ã‚Œã¦ èŠ¦ã®ã¾ã‚ã‚„ã« ç§‹é¢¨ãå¹ã\tã„ã† ã‚ã—\tè¨€ã†è¶³
72\téŸ³ã«èã é«˜å¸«ã®æµœã® ã‚ã æ³¢ã¯ ã‹ã‘ã˜ã‚„è¢–ã® æ¿¡ã‚Œã‚‚ã“ãã™ã‚Œ\tãŠã¨ã‚’ ã‹ã‘ã‚‹\téŸ³ã‚’ã‹ã‘ã‚‹
73\té«˜ç ‚ã® å°¾ã®ä¸Šã®æ¡œ å’²ãã«ã‘ã‚Š å¤–å±±ã®éœ ãŸãŸãšã‚‚ã‚ã‚‰ãªã‚€\tãŸã‹ ã¨ã‚„ã¾\té·¹ã¨å±±
74\tã†ã‹ã‚Šã‘ã‚‹ äººã‚’åˆç€¬ã® å±±ãŠã‚ã—ã‚ˆ ã¯ã’ã—ã‹ã‚Œã¨ã¯ ç¥ˆã‚‰ã¬ã‚‚ã®ã‚’\tã†ã£ã‹ã‚Š ãƒã‚²\tã†ã£ã‹ã‚Šãƒã‚²
75\tå¥‘ã‚ŠãŠãã— ã•ã›ã‚‚ãŒéœ²ã‚’ å‘½ã«ã¦ ã‚ã¯ã‚Œä»Šå¹´ã® ç§‹ã‚‚ã„ã¬ã‚ã‚Š\tã¡ãã‚ŠãŠ ã‚ã‚ã‚Œ\tåƒåˆ‡ã‚Šå°¾ã€å“€ã‚Œ
76\tã‚ãŸã®åŸ æ¼•ãå‡ºã§ã¦è¦‹ã‚Œã° ä¹…æ–¹ã® é›²å±…ã«ã¾ãŒãµ æ²–ã¤ç™½æ³¢\tã‚ãŸã®ã¯ã‚‰ ã“ãã‚‚ã„ã‚‹\tã‚ãŸã®åŸ å­èœ˜è››ã„ã‚‹
77\tç€¬ã‚’æ—©ã¿ å²©ã«ã›ã‹ã‚‹ã‚‹ æ»å·ã® ã‚ã‚Œã¦ã‚‚æœ«ã« ã‚ã¯ã‚€ã¨ãæ€ãµ\tã› ã‚ã‚Œ\tèƒŒå‰²ã‚Œ
78\tæ·¡è·¯å³¶ é€šãµåƒé³¥ã® é³´ãå£°ã« å¹¾å¤œå¯è¦šã‚ã¬ é ˆç£¨ã®é–¢å®ˆ\tã‚ã‚ã˜ã—ã¾ ã„ãã‚ˆ\tæ·¡è·¯å³¶è¡Œãã‚ˆ
79\tç§‹é¢¨ã« ãŸãªã³ãé›²ã® çµ¶ãˆé–“ã‚ˆã‚Š ã‚‚ã‚Œå‡ºã¥ã‚‹æœˆã® å½±ã®ã•ã‚„ã‘ã•\tã‚ãã‹ãœ ã‚‚ã‚Œã„ã¥ã‚‹\tç§‹é¢¨ã€ã‚‚ã‚Œå‡ºã¥ã‚‹
80\té•·ã‹ã‚‰ã‚€ å¿ƒã‚‚çŸ¥ã‚‰ãš é»’é«ªã® ä¹±ã‚Œã¦ã‘ã•ã¯ ç‰©ã‚’ã“ãæ€ã¸\tãªãŒã‹ã‚‰ ã¿ã ã‚Œã¦\té•·ã‹ã‚‰ã€ä¹±ã‚Œã¦
81\tã»ã¨ã¨ãã™ é³´ãã¤ã‚‹æ–¹ã‚’ çœºã‚€ã‚Œã° ãŸã æœ‰ã‚Šæ˜ã‘ã® æœˆãæ®‹ã‚Œã‚‹\tã»ã¨ã¨ãã™ã¯ ãŸã \tã»ã¨ã¨ãã™ã¯ã‚¿ãƒ€
82\tæ€ã²ã‚ã³ ã•ã¦ã‚‚å‘½ã¯ ã‚ã‚‹ã‚‚ã®ã‚’ æ†‚ãã«ãŸã¸ã¬ã¯ æ¶™ãªã‚Šã‘ã‚Š\tãŠã‚‚ã„ ã†ãã‚\té‡ã„æµ®ãè¼ª
83\tä¸–ã®ä¸­ã‚ˆ é“ã“ããªã‘ã‚Œ æ€ã²å…¥ã‚‹ å±±ã®å¥¥ã«ã‚‚ é¹¿ãé³´ããªã‚‹\tã‚ˆã®ãªã‹ã‚ˆ ã‚„ã¾ã®ãŠã\tä¸–ã®ä¸­ã‚ˆã€å±±ã®å¥¥
84\tãªãŒã‚‰ã¸ã° ã¾ãŸã“ã®é ƒã‚„ å¿ã°ã‚Œã‚€ æ†‚ã—ã¨è¦‹ã—ä¸–ã ä»Šã¯æ‹ã—ã\tãªãŒã‚‰ ã†ã—\tãªãŒã‚‰ç‰›
85\tå¤œã‚‚ã™ãŒã‚‰ ç‰©æ€ãµé ƒã¯ æ˜ã‘ã‚„ã‚‰ã§ é–ã®ã²ã¾ã•ã¸ ã¤ã‚Œãªã‹ã‚Šã‘ã‚Š\tã‚ˆã†ã‚‚ ã­ã‡ã‚„\tç”¨ã‚‚ã­ã‡ã‚„
86\tå˜†ã‘ã¨ã¦ æœˆã‚„ã¯ç‰©ã‚’ æ€ã¯ã™ã‚‹ ã‹ã“ã¡é¡”ãªã‚‹ ã‚ãŒæ¶™ã‹ãª\tãªã’ã‘ ã‹ã“\tå˜†ã‘éå»
87\tæ‘é›¨ã® éœ²ã‚‚ã¾ã å¹²ã¬ æ§‡ã®è‘‰ã« éœ§ç«‹ã¡ã®ã¼ã‚‹ ç§‹ã®å¤•æš®ã‚Œ\tã‚€ ãï½\tãƒ ã‚­ï½
88\té›£æ³¢æ±Ÿã® èŠ¦ã®ã‹ã‚Šã­ã® ã²ã¨ã‚ˆã‚†ã‚‘ ã¿ã‚’ã¤ãã—ã¦ã‚„ æ‹ã²ã‚ãŸã‚‹ã¹ã\tãªã«ã‚ãˆã® ã¿ãŠã¤ãã—ã‚„ã\té›£æ³¢æ±Ÿã®æ¾ªæ¨™ã‚„ã
89\tç‰ã®ç·’ã‚ˆ çµ¶ãˆãªã°çµ¶ãˆã­ ãªãŒã‚‰ã¸ã° å¿ã¶ã‚‹ã“ã¨ã® å¼±ã‚Šã‚‚ãã™ã‚‹\tãŸã¾ ã—ã®ã¶\tç‰å¿ã¶
90\tè¦‹ã›ã°ã‚„ãª é›„å³¶ã®æµ·äººã® è¢–ã ã«ã‚‚ æ¿¡ã‚Œã«ãæ¿¡ã‚Œã— è‰²ã¯å¤‰ã¯ã‚‰ãš\tã¿ã› ã¬\tè¦‹ã›ã¬
91\tãã‚Šãã‚Šã™ é³´ãã‚„éœœå¤œã® ã•ã‚€ã—ã‚ã« è¡£ã‹ãŸã—ã ã²ã¨ã‚Šã‹ã‚‚å¯ã‚€\tãã‚Šãã‚Šã™ã® ã“ã‚ã‚‚ã¯ã‹ãŸã„\tãã‚Šãã‚Šã™ã®è¡£ã¯å›ºã„
92\tã‚ãŒè¢–ã¯ æ½®å¹²ã«è¦‹ãˆã¬ æ²–ã®çŸ³ã® äººã“ãçŸ¥ã‚‰ã­ ä¹¾ãé–“ã‚‚ãªã—\tã‚ãŒãã§ã¯ ã²ã¨ã“ãã—ã‚‰ã­\tæˆ‘ãŒè¢–ã¯äººã“ãçŸ¥ã‚‰ã­
93\tä¸–ã®ä¸­ã¯ å¸¸ã«ã‚‚ãŒã‚‚ãª æ¸šæ¼•ã æµ·äººã®å°èˆŸã® ç¶±æ‰‹ã‹ãªã—ã‚‚\tã‚ˆã®ãªã‹ã¯ ã‚ã¾ã®ãŠ\tä¸–ã®ä¸­ã¯æµ·å¥³ã®å°¾
94\tã¿å‰é‡ã® å±±ã®ç§‹é¢¨ ã•å¤œæ›´ã‘ã¦ ãµã‚‹ã•ã¨å¯’ã è¡£æ‰“ã¤ãªã‚Š\tã¿ã‚ˆ ãµã‚‹ã•ã¨\tè¦‹ã‚ˆã€ãµã‚‹ã•ã¨
95\tãŠã»ã‘ãªã ã†ãä¸–ã®æ°‘ã« è¦†ãµã‹ãª æˆ‘ãŒç«‹ã¤æ£ã« å¢¨æŸ“ã®è¢–\tã‚ªãƒ¼ã‚±ãƒ¼ ã‚ã‹ã£ãŸ\tOKã‚ã‹ã£ãŸ
96\tèŠ±ã•ããµ åµã®åº­ã® é›ªãªã‚‰ã§ ãµã‚Šã‚†ãã‚‚ã®ã¯ æˆ‘ãŒèº«ãªã‚Šã‘ã‚Š\tã¯ãª ã•ãã†ãµã‚Š\tèŠ±èª˜ã†ãµã‚Š
97\tæ¥ã¬äººã‚’ æ¾å¸†ã®æµ¦ã® å¤•å‡ªã« ç„¼ãã‚„è—»å¡©ã® èº«ã‚‚ã“ãŒã‚Œã¤ã¤\tã“ã¬ã²ã¨ã‚’ ã‚„ã\tæ¥ã¬äººã‚’ç„¼ã
98\té¢¨ãã‚ˆã ãªã‚‰ã®å°å·ã® å¤•æš®ã‚Œã¯ ã¿ãããå¤ã® ã—ã‚‹ã—ãªã‚Šã‘ã‚‹\tã‹ãœãã‚ˆã ã¿ã\té¢¨ãã‚ˆãå‘³å™Œ
99\täººã‚‚æƒœã— äººã‚‚æ¨ã‚ã— ã‚ã¢ããªã ä¸–ã‚’æ€ãµæ•…ã« ã‚‚ã®æ€ãµèº«ã¯\tã²ã¨ã‚‚ ã‚ˆãŠã‰ï½\täººã‚‚ã‚ˆãŠã‰ï½
100\tã‚‚ã‚‚ã—ãã‚„ å¤ãè»’ç«¯ã® ã—ã®ã¶ã«ã‚‚ ãªã»ã‚ã¾ã‚Šã‚ã‚‹ æ˜”ãªã‚Šã‘ã‚Š\tã‚‚ã‚‚ ãªãŠã‚ã¾ã‚Š\tæ¡ƒã€ãªãŠä½™ã‚Š`;

/* =========================
   ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
   ========================= */
function normalizeSpaces(s){ return (s||"").replace(/\s+/g," ").trim(); }
function nowString(){
  const d=new Date();
  const pad=n=>String(n).padStart(2,"0");
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
}
function splitKamiShimo(waka){
  const parts=normalizeSpaces(waka).split(" ");
  if(parts.length>=5){
    const kami=parts.slice(0,3).join(" ");
    const shimo=parts.slice(3,5).join(" ");
    const rest=parts.slice(5).join(" ");
    return {kami, shimo: normalizeSpaces([shimo,rest].filter(Boolean).join(" "))};
  }
  const mid=Math.max(1, Math.floor(parts.length*0.6));
  return {kami:parts.slice(0,mid).join(" "), shimo:parts.slice(mid).join(" ")};
}
function parseTSV(raw){
  const lines=raw.split(/\r?\n/).filter(l=>l.trim().length);
  const out=[];
  for(let i=1;i<lines.length;i++){
    const cols=lines[i].split("\t");
    if(cols.length<4) continue;
    const id=parseInt(cols[0],10);
    const waka=normalizeSpaces(cols[1]);
    const kimariji=normalizeSpaces(cols[2]);
    const goro=normalizeSpaces(cols[3]);
    const {kami,shimo}=splitKamiShimo(waka);
    out.push({id,waka,kami,shimo,kimariji,goro});
  }
  out.sort((a,b)=>a.id-b.id);
  return out;
}
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* =========================
   ãƒ‡ãƒ¼ã‚¿
   ========================= */
const POEMS=parseTSV(RAW_TSV);
function getPoemById(id){ return POEMS.find(p=>p.id===id); }

/* =========================
   æ°¸ç¶šåŒ–
   ========================= */
const STORAGE_KEY="hyakunin_22_kumikatsu_v3";
function loadState(){
  try{
    const raw=localStorage.getItem(STORAGE_KEY);
    if(!raw) return {stats:{}, streak:0, lastId:null, history:[], best:{score:-1, level:0, at:null, msg:""}};
    const obj=JSON.parse(raw);
    if(!obj.stats) obj.stats={};
    if(typeof obj.streak!=="number") obj.streak=0;
    if(!Array.isArray(obj.history)) obj.history=[];
    if(!obj.best) obj.best={score:-1, level:0, at:null, msg:""};
    return obj;
  }catch(e){
    return {stats:{}, streak:0, lastId:null, history:[], best:{score:-1, level:0, at:null, msg:""}};
  }
}
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
const state=loadState();
function ensureStat(id){
  if(!state.stats[id]) state.stats[id]={good:0,bad:0};
  return state.stats[id];
}
function computeOverall(){
  const ids=POEMS.map(p=>p.id);
  let done=0, good=0, bad=0;
  for(const id of ids){
    const st=state.stats[id];
    if(st && (st.good+st.bad)>0){
      done++; good+=st.good; bad+=st.bad;
    }
  }
  const totalAns=good+bad;
  const rate=totalAns?Math.round((good/totalAns)*100):null;
  return {done,good,bad,rate,total:ids.length,streak:state.streak||0};
}

/* =========================
   å‡ºé¡Œãƒ—ãƒ¼ãƒ«
   ========================= */
function pickFromPool(mode){
  const ids=POEMS.map(p=>p.id);
  if(mode==="unseen"){
    const unseen=ids.filter(id=>{
      const st=state.stats[id];
      return !(st && (st.good+st.bad)>0);
    });
    return unseen.length?unseen:ids;
  }
  if(mode==="weak"){
    const weighted=ids.map(id=>{
      const st=state.stats[id]||{good:0,bad:0};
      const total=st.good+st.bad;
      const badRate=total?(st.bad/total):0.6;
      const score=(st.bad*2)+(badRate*5)+(total===0?1.5:0);
      return {id,w:Math.max(0.1,score)};
    });
    const sum=weighted.reduce((a,c)=>a+c.w,0);
    let r=Math.random()*sum;
    for(const it of weighted){
      r-=it.w;
      if(r<=0) return [it.id];
    }
    return ids;
  }
  return ids;
}
function pickNextId(){
  const mode=document.getElementById("modeSel").value;
  const pool=pickFromPool(mode);
  const candidates=pool.filter(id=>id!==state.lastId);
  const list=candidates.length?candidates:pool;
  const id=list[Math.floor(Math.random()*list.length)];
  state.lastId=id;
  saveState();
  return id;
}

/* =========================
   4æŠ
   ========================= */
function makeChoices(correctPoem){
  const correct=correctPoem.shimo;
  const others=POEMS.filter(p=>p.id!==correctPoem.id).map(p=>p.shimo);
  const uniq=Array.from(new Set(others));
  shuffle(uniq);
  return shuffle([correct, ...uniq.slice(0,3)]);
}

/* =========================
   20å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆæ®µä½ï¼†æ´¾æ‰‹è¡¨å½°ï¼‰
   ========================= */
const SET_SIZE=20;
let setMode=false;
let setIndex=0;
let setCorrect=0;

function levelFromScore(score){
  if(score>=20) return 10;
  if(score>=18) return 9;
  if(score>=16) return 8;
  if(score>=14) return 7;
  if(score>=12) return 6;
  if(score>=10) return 5;
  if(score>=8)  return 4;
  if(score>=6)  return 3;
  if(score>=4)  return 2;
  return 1;
}
function levelMessage(level){
  const map={
    10:"ã‚ãªãŸã¯é˜¿å€ä»²éº»å‘‚ã§ã™ï¼ï¼’çµ„ã®èª‡ã‚Šã§ã™ï¼",
    9:"ã‚ãªãŸã¯å±±ç”°å…ˆç”Ÿã¨åŒã˜ãƒ¬ãƒ™ãƒ«ã§ã™ï¼ã™ã”ã„ï¼",
    8:"ã‚ãªãŸã¯ç¾ä»£ã®ç´«å¼éƒ¨ã§ã™ï¼",
    7:"ã‚ãªãŸã¯ç¾ä»£ã®æ¸…å°‘ç´è¨€ã§ã™ï¼",
    6:"ã‚ãªãŸã¯ä»²å‰é–€å…ˆç”Ÿã¨åŒã˜ãƒ¬ãƒ™ãƒ«ã§ã™ï¼",
    5:"ã‚ãªãŸã¯ä¸€èˆ¬äººã§ã™ï¼æ™®é€šã§ã™ï¼",
    4:"æ—å…ˆç”Ÿã¨åŒãƒ¬ãƒ™ãƒ«ã®å®ŸåŠ›ã§ã™ï¼",
    3:"ã§ããªã„ã¯ä¼¸ã³ã—ã‚ã§ã™ï¼ãŒã‚“ã°ã‚Œï¼",
    2:"ã„ã‚„ã„ã‚„ã€ãã‚Œã¯ã¡ã‚‡ã£ã¨ãƒ»ãƒ»ãƒ»ï¼’çµ„ãªã‚‰ã§ãã‚‹ï¼",
    1:"å¤§ä¸ˆå¤«ãƒ»ãƒ»ãƒ»ã¾ã æ™‚é–“ã¯ã‚ã‚‹ãƒ»ãƒ»ãƒ»è¦šãˆã‚ˆã†"
  };
  return map[level]||"";
}
function updateSetPill(){
  document.getElementById("setPill").textContent =
    setMode ? `ã‚»ãƒƒãƒˆï¼š${setIndex}/${SET_SIZE}ï¼ˆæ­£è§£${setCorrect}ï¼‰` : "ã‚»ãƒƒãƒˆï¼šâ€”";
}
function computeBestFromHistory(){
  // bestã‚’ç¢ºå®Ÿã«ã—ãŸã„ï¼ˆå¤ã„ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å¾©å…ƒï¼‰
  const h=state.history||[];
  let bestScore = (state.best?.score ?? -1);
  let best = state.best || {score:-1, level:0, at:null, msg:""};
  for(const r of h){
    if(r.correct > bestScore){
      bestScore = r.correct;
      best = {score:r.correct, level:r.level, at:r.at, msg:r.message};
    }
  }
  state.best = best;
  saveState();
}
function updateBestPill(){
  computeBestFromHistory();
  if(state.best && state.best.score>=0){
    document.getElementById("bestPill").textContent = `ãƒ™ã‚¹ãƒˆï¼š${state.best.score}/20ï¼ˆLv.${state.best.level}ï¼‰`;
  }else{
    document.getElementById("bestPill").textContent = "ãƒ™ã‚¹ãƒˆï¼šâ€”";
  }
}
function startSet(){
  setMode=true;
  setIndex=0;
  setCorrect=0;
  updateSetPill();
  nextQuestion();
}

/* ===== è¡¨å½°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º ===== */
function showAward(record, isNewBest){
  const overlay=document.getElementById("awardOverlay");
  const badge=document.getElementById("awardBadge");
  const badgeText=document.getElementById("awardBadgeText");

  // ãƒãƒƒã‚¸æ¼”å‡ºï¼ˆLv10/9/8ã ã‘æ´¾æ‰‹ï¼‰
  badge.className = "badge"; // reset
  if(record.level===10){ badge.classList.add("lv10"); badgeText.textContent=`Lv.10 ä¼èª¬ç´š`; }
  else if(record.level===9){ badge.classList.add("lv9"); badgeText.textContent=`Lv.9 è¶…ä¸€æµ`; }
  else if(record.level===8){ badge.classList.add("lv8"); badgeText.textContent=`Lv.8 ä¸€æµ`; }
  else { badgeText.textContent=`Lv.${record.level} ç§°å·`; }

  document.getElementById("awardScore").textContent = `${record.correct} / ${record.total}`;
  document.getElementById("awardMsg").textContent = record.message;
  document.getElementById("awardWhen").textContent = `æ—¥æ™‚ï¼š${record.at}`;
  document.getElementById("awardLine").textContent = `20å•ä¸­ ${record.correct}å•æ­£è§£ â†’ Lv.${record.level}ï¼š${record.message}`;

  // ãƒ™ã‚¹ãƒˆè¡¨ç¤º
  updateBestPill();
  const best = state.best && state.best.score>=0 ? state.best : record;
  const bestLine = `ãƒ™ã‚¹ãƒˆï¼š${best.score}/20ï¼ˆLv.${best.level}ï¼‰${best.at ? "  @"+best.at : ""}`;
  document.getElementById("awardBestDetail").textContent = bestLine;
  document.getElementById("awardBestNow").textContent = isNewBest ? "ğŸ‰ ãƒ™ã‚¹ãƒˆæ›´æ–°ï¼" : "ãƒ™ã‚¹ãƒˆæ›´æ–°ãªã‚‰ãš";

  overlay.classList.add("show");
  overlay.setAttribute("aria-hidden","false");
}
function hideAward(){
  const overlay=document.getElementById("awardOverlay");
  overlay.classList.remove("show");
  overlay.setAttribute("aria-hidden","true");
}

/* =========================
   å±¥æ­´
   ========================= */
function renderHistory(){
  const wrap=document.getElementById("historyWrap");
  const h=state.history||[];
  if(!h.length){
    wrap.textContent="ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆ20å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’ã™ã‚‹ã¨è¨˜éŒ²ã•ã‚Œã¾ã™ï¼‰ã€‚";
    return;
  }
  const rows=h.map((r,idx)=>{
    const line=`${r.total}å•ä¸­ ${r.correct}å• â†’ Lv.${r.level}ï¼š${r.message}`;
    return `<tr>
      <td class="mono">${escapeHtml(r.at)}</td>
      <td>${escapeHtml(line)}</td>
      <td class="right">${idx===0?'<span class="tag">æœ€æ–°</span>':''}</td>
    </tr>`;
  }).join("");
  wrap.innerHTML=`
    <table>
      <thead><tr>
        <th style="width:170px;">æ—¥æ™‚</th><th>çµæœ</th><th class="right" style="width:70px;"> </th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>
    <div class="footerNote">â€»å±¥æ­´ã¯ã“ã®ç«¯æœ«ã ã‘ã«ä¿å­˜ï¼ˆæœ€å¤§100ä»¶ï¼‰ã€‚</div>
  `;
}
function clearHistory(){
  if(!confirm("20å•ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã®å±¥æ­´ã‚’æ¶ˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
  state.history=[];
  state.best={score:-1, level:0, at:null, msg:""};
  saveState();
  renderHistory();
  updateBestPill();
}

/* =========================
   UIåˆ¶å¾¡
   ========================= */
let currentPoem=null;
let locked=false;

function updateHeader(){
  const mode=document.getElementById("modeSel").value;
  const map={normal:"é€šå¸¸", weak:"è‹¦æ‰‹å¾©ç¿’", unseen:"æœªæŒ‘æˆ¦"};
  document.getElementById("modePill").textContent=`ãƒ¢ãƒ¼ãƒ‰ï¼š${map[mode]||"é€šå¸¸"}`;

  const s=computeOverall();
  document.getElementById("scorePill").textContent = (s.rate===null) ? "æ­£è§£ç‡ï¼šâ€”" : `æ­£è§£ç‡ï¼š${s.rate}%`;
  document.getElementById("streakPill").textContent = `é€£ç¶šï¼š${s.streak}`;
}
function showQuiz(){
  document.getElementById("quizCard").style.display="";
  document.getElementById("resultCard").style.display="none";
}
function showResult(){
  document.getElementById("quizCard").style.display="none";
  document.getElementById("resultCard").style.display="";
}
function renderQuiz(poem){
  currentPoem=poem;
  locked=false;

  document.getElementById("kami").textContent=poem.kami;
  document.getElementById("indexPill").textContent=`å‡ºé¡Œï¼šNo.${poem.id}`;

  const wrap=document.getElementById("choices");
  wrap.innerHTML="";
  const choices=makeChoices(poem);
  choices.forEach(choiceText=>{
    const btn=document.createElement("button");
    btn.className="choiceBtn";
    btn.textContent=choiceText;
    btn.addEventListener("click", ()=>onAnswer(choiceText, btn));
    wrap.appendChild(btn);
  });

  showQuiz();
  updateHeader();
  updateSetPill();
  updateBestPill();
}
function renderResult({isCorrect, pickedText, setLineText}){
  const title=document.getElementById("resultTitle");
  if(isCorrect){
    title.textContent="âœ… æ­£è§£ï¼";
    title.insertAdjacentHTML("beforeend", ` <span class="tag">é¸æŠï¼šOK</span>`);
  }else{
    title.textContent="âŒ ä¸æ­£è§£â€¦";
    title.insertAdjacentHTML("beforeend", ` <span class="tag warn">é¸æŠï¼š${escapeHtml(pickedText)}</span>`);
  }

  document.getElementById("correctAnswer").textContent=`ä¸‹ã®å¥ï¼š${currentPoem.shimo}`;
  document.getElementById("kimariji").textContent=currentPoem.kimariji||"â€”";
  document.getElementById("goro").textContent=currentPoem.goro||"â€”";
  document.getElementById("fullwaka").textContent=currentPoem.waka;
  document.getElementById("no").textContent=`No.${currentPoem.id}`;
  document.getElementById("setResultLine").textContent=setLineText||"â€”";

  showResult();
  updateHeader();
  updateSetPill();
  updateBestPill();
}
function lockChoices(){ document.querySelectorAll(".choiceBtn").forEach(b=>b.disabled=true); }
function markButtons(pickedBtn){
  const btns=Array.from(document.querySelectorAll(".choiceBtn"));
  btns.forEach(b=>{ if(b.textContent===currentPoem.shimo) b.classList.add("correct"); });
  if(pickedBtn && pickedBtn.textContent!==currentPoem.shimo) pickedBtn.classList.add("wrong");
}

function onAnswer(pickedText, pickedBtn){
  if(locked) return;
  locked=true;
  const isCorrect=(pickedText===currentPoem.shimo);

  lockChoices();
  markButtons(pickedBtn);

  // å­¦ç¿’è¨˜éŒ²
  const st=ensureStat(currentPoem.id);
  if(isCorrect){ st.good+=1; state.streak=(state.streak||0)+1; }
  else { st.bad+=1; state.streak=0; }

  // ã‚»ãƒƒãƒˆå‡¦ç†
  let setLineText="â€”";
  let justFinishedRecord=null;
  let isNewBest=false;

  if(setMode){
    setIndex += 1;
    if(isCorrect) setCorrect += 1;

    if(setIndex >= SET_SIZE){
      const level=levelFromScore(setCorrect);
      const msg=levelMessage(level);
      const record={at:nowString(), correct:setCorrect, total:SET_SIZE, level, message:msg};

      // å±¥æ­´ä¿å­˜
      state.history.unshift(record);
      state.history = state.history.slice(0,100);

      // ãƒ™ã‚¹ãƒˆæ›´æ–°åˆ¤å®šï¼ˆç‚¹æ•°å„ªå…ˆã€åŒç‚¹ãªã‚‰ãƒ¬ãƒ™ãƒ«/æ—¥æ™‚ã§ç¶­æŒï¼‰
      computeBestFromHistory();
      if(record.correct > (state.best?.score ?? -1)){
        state.best = {score:record.correct, level:record.level, at:record.at, msg:record.message};
        isNewBest = true;
      }else{
        // æ—¢ã«bestãŒé«˜ã„å ´åˆã¯ãã®ã¾ã¾
      }

      setLineText = `20å•ä¸­ ${record.correct}å•æ­£è§£ â†’ ${record.level}ãƒ¬ãƒ™ãƒ«ï¼š${record.message}`;

      // ã‚»ãƒƒãƒˆçµ‚äº†
      setMode=false;

      justFinishedRecord = record;
    }
  }

  saveState();

  // çµæœè¡¨ç¤ºï¼ˆæœ€å¾Œã®20å•ãªã‚‰â€œè¡¨å½°â€ã‚’ãƒ‰ãƒ¼ãƒ³ï¼‰
  setTimeout(()=> {
    renderResult({isCorrect, pickedText, setLineText: (justFinishedRecord? setLineText : "â€”")});

    if(justFinishedRecord){
      renderHistory();
      updateBestPill();
      // è¡¨å½°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
      showAward(justFinishedRecord, (justFinishedRecord.correct >= (state.best?.score ?? -1)) && isNewBest);
    }
  }, isCorrect ? 350 : 450);
}

/* =========================
   ãƒœã‚¿ãƒ³
   ========================= */
function nextQuestion(){
  const id=pickNextId();
  const poem=getPoemById(id);
  renderQuiz(poem);
}
function sameAgain(){
  if(!currentPoem) return;
  renderQuiz(currentPoem);
}
function resetAll(){
  if(!confirm("å­¦ç¿’è¨˜éŒ²ï¼ˆæ­£èª¤ãƒ»é€£ç¶šãªã©ï¼‰ã¨å±¥æ­´ã‚’å…¨éƒ¨ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
}

/* iOSã‚¿ãƒƒãƒ—å®‰å®šåŒ– */
document.addEventListener("touchstart", function(){}, {passive:true});

/* events */
document.getElementById("btnNext").addEventListener("click", nextQuestion);
document.getElementById("btnNext2").addEventListener("click", nextQuestion);
document.getElementById("btnShowAgain").addEventListener("click", sameAgain);
document.getElementById("btnStartSet").addEventListener("click", startSet);
document.getElementById("modeSel").addEventListener("change", ()=>{ updateHeader(); nextQuestion(); });
document.getElementById("btnReset").addEventListener("click", resetAll);
document.getElementById("btnClearHistory").addEventListener("click", clearHistory);

// è¡¨å½°
document.getElementById("btnCloseAward").addEventListener("click", ()=>{
  hideAward();
  nextQuestion();
});
document.getElementById("awardOverlay").addEventListener("click", (e)=>{
  // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹ï¼ˆã‚«ãƒ¼ãƒ‰å†…ã‚¯ãƒªãƒƒã‚¯ã¯ç„¡è¦–ï¼‰
  if(e.target.id==="awardOverlay"){
    hideAward();
    nextQuestion();
  }
});

/* start */
if(!POEMS.length){
  alert("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚RAW_TSVã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
}else{
  renderHistory();
  updateHeader();
  updateSetPill();
  updateBestPill();
  nextQuestion();
}
</script>
</body>
</html>
